name: Delete branch after PR merge

on:
  pull_request:
    types:
      - closed

jobs:
  delete-branch:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
    - name: Delete Branch
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        BRANCH_NAME="${{ github.head_ref }}"
        # 보호 브랜치 목록
        PROTECTED_BRANCHES=("main" "develop" "release")
        
        # 보호 브랜치면 삭제 안 함
        if [[ " ${PROTECTED_BRANCHES[@]} " =~ " ${BRANCH_NAME} " ]]; then
          echo "Protected branch, skipping deletion: $BRANCH_NAME"
          exit 0
        fi
        
        echo "Deleting branch: $BRANCH_NAME"
        curl -X DELETE \
          -H "Authorization: token $GITHUB_TOKEN" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/${{ github.repository }}/git/refs/heads/$BRANCH_NAME
